#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>

void bubbleSort(int a[], int n) {
    int i, j, temp;
    for (i = 0; i < n - 1; i++)
        for (j = 0; j < n - i - 1; j++)
            if (a[j] > a[j + 1]) {
                temp = a[j];
                a[j] = a[j + 1];
                a[j + 1] = temp;
            }
}

int main() {
    int n;
    printf("Enter number of integers: ");
    scanf("%d", &n);

    int arr[n];
    printf("Enter %d integers: ", n);
    for (int i = 0; i < n; i++)
        scanf("%d", &arr[i]);

    pid_t pid = fork();

    if (pid == 0) {
        // ---- Child process ----
        printf("\n[Child] PID=%d, Parent PID=%d\n", getpid(), getppid());
        
        bubbleSort(arr, n);
        printf("[Child] Sorted array: ");
        for (int i = 0; i < n; i++)
            printf("%d ", arr[i]);
            printf("\n");
            
            printf("[Child] Sleeping for 5 seconds...\n");
            sleep(5); // Parent will exit before this finishes
        printf("[Child] Woke up! New Parent PID=%d (orphaned and adopted by init/systemd)\n", getppid());
    } 
    else if (pid > 0) {
        // ---- Parent process ----
        printf("\n[Parent] PID=%d, Child PID=%d\n", getpid(), pid);
        printf("[Parent] Exiting in 2 seconds, making child orphan...\n");
        sleep(2);  // Parent exits before child wakes up
        printf("[Parent] Exiting now.\n");
        exit(0);
    } 
    else {
        perror("fork failed");
    }

    return 0;
}
